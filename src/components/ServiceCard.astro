---
// Internal utilities and types
import WhatsAppCTA from './WhatsAppCTA.astro';

// Destructure props with defaults
const { service, category = 'general' } = Astro.props;

// Format price in Chilean pesos
const formattedPrice = new Intl.NumberFormat('es-CL', {
  style: 'currency',
  currency: 'CLP',
  minimumFractionDigits: 0
}).format(service.priceCLP);

// Generate WhatsApp message for this specific service
const whatsappMessage = `Hola! Me interesa el servicio "${service.name}" (${formattedPrice}). ¿Podrían ayudarme con la reserva?`;
---

<div 
  class="group relative h-full flex flex-col bg-white rounded-2xl border border-sage-100 p-6 lg:p-8 transition-all duration-500 hover:shadow-xl hover:shadow-sage-200/30 hover:-translate-y-2 hover:border-sage-200 overflow-hidden"
  data-service-id={service.id}
  data-category={category}
>
  <!-- Background gradient overlay -->
  <div class="absolute inset-0 bg-gradient-to-br from-sage-50/0 via-sage-50/0 to-sage-100/50 opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
  
  <!-- Decorative corner element -->
  <div class="absolute -top-2 -right-2 w-16 h-16 bg-gradient-to-br from-copper-200/30 to-copper-300/40 rounded-full opacity-0 group-hover:opacity-100 transition-all duration-500 transform group-hover:scale-150"></div>
  <!-- Service Header -->
  <div class="relative flex-grow z-10">
    <div class="flex items-start justify-between mb-4">
      <h3 class="text-xl lg:text-2xl font-bold text-sage-800 leading-tight pr-4 group-hover:text-sage-900 transition-colors duration-300">
        {service.name}
      </h3>
      {service.featured && (
        <span class="inline-flex items-center px-3 py-1 text-xs font-semibold bg-gradient-to-r from-copper-500 to-copper-600 text-white rounded-full flex-shrink-0 shadow-sm">
          ⭐ Destacado
        </span>
      )}
    </div>
    
    <!-- Description -->
    <p class="text-neutral-600 leading-relaxed mb-6 text-base lg:text-lg group-hover:text-neutral-700 transition-colors duration-300">
      {service.description}
    </p>
  </div>

  <!-- Service Footer -->
  <div class="relative mt-auto z-10">
    <!-- Duration and Price Row -->
    <div class="flex items-center justify-between mb-6 p-4 bg-gradient-to-r from-sage-50 to-cream-50 rounded-xl border border-sage-100/50">
      <div class="flex items-center space-x-4">
        {service.durationMin && (
          <div class="flex items-center text-sm text-sage-600">
            <div class="w-8 h-8 bg-sage-200 rounded-full flex items-center justify-center mr-2">
              <svg class="w-4 h-4 text-sage-700" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
              </svg>
            </div>
            <span class="font-medium">{service.durationMin} min</span>
          </div>
        )}
      </div>
      <div class="text-right">
        <div class="text-xs text-sage-600 font-medium uppercase tracking-wide mb-1">Precio</div>
        <div class="text-2xl lg:text-3xl font-bold text-sage-800 leading-none">
          {formattedPrice}
        </div>
      </div>
    </div>

    <!-- Enhanced WhatsApp CTA -->
    <WhatsAppCTA 
      source="card" 
      serviceId={service.id}
      message={whatsappMessage}
      className="group/btn relative w-full inline-flex items-center justify-center px-6 py-4 bg-gradient-to-r from-green-600 to-green-700 text-white font-semibold rounded-xl shadow-lg hover:shadow-xl hover:from-green-700 hover:to-green-800 transition-all duration-300 transform hover:scale-105 overflow-hidden"
    >
      <!-- Button background effect -->
      <div class="absolute inset-0 bg-gradient-to-r from-green-700 to-green-800 opacity-0 group-hover/btn:opacity-100 transition-opacity duration-300"></div>
      
      <!-- Button content -->
      <div class="relative flex items-center">
        <svg class="w-5 h-5 mr-3 group-hover/btn:scale-110 transition-transform duration-200" fill="currentColor" viewBox="0 0 24 24">
          <path d="M12.04 2c-5.46 0-9.91 4.45-9.91 9.91 0 1.75.46 3.45 1.32 4.95L2.05 22l5.25-1.38c1.45.79 3.08 1.21 4.74 1.21 5.46 0 9.91-4.45 9.91-9.91C21.95 6.45 17.5 2 12.04 2zm5.76 7.12c-.05-.11-.18-.18-.38-.31-.2-.14-1.17-.58-1.35-.64-.18-.07-.31-.1-.44.1-.14.2-.53.64-.65.77-.12.14-.24.16-.44.05-.2-.1-.85-.31-1.62-.99-.6-.53-1-.19-1.18-.02-.18.16-.22.26-.33.41-.1.14-.2.16-.37.05-.18-.1-.75-.28-1.43-.88-.63-.53-1.06-1.18-1.18-1.38-.12-.2-.01-.31.09-.41.09-.09.2-.24.3-.36.1-.12.14-.2.2-.34.07-.14.04-.26-.02-.36-.06-.1-.44-1.07-.6-1.46-.16-.38-.32-.33-.44-.33-.11 0-.24-.01-.37-.01-.12 0-.32.05-.49.24-.17.2-.65.63-.65 1.54s.67 1.79.76 1.91c.1.12 1.32 2.02 3.2 2.83.45.19.8.31 1.07.4.45.14.86.12 1.18.07.36-.05 1.17-.48 1.33-.94.16-.46.16-.85.11-.94z"/>
        </svg>
        <span class="text-base lg:text-lg">Reservar Ahora</span>
        <svg class="w-4 h-4 ml-2 group-hover/btn:translate-x-1 transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path>
        </svg>
      </div>
    </WhatsAppCTA>
  </div>
</div>
