---
// TypeScript props interface
interface Props {
  title: string;
  description?: string;
  keywords?: string[];
  structuredData?: string;
  className?: string;
}

// Destructure props with defaults
const { 
  title, 
  description = '', 
  keywords = [],
  className = '' 
} = Astro.props;

// Import SEO utilities
import { defaultSEO, generateCanonicalUrl, generateKeywords } from '../lib/seo';

// Import global styles (Tailwind + custom utilities)
import '../styles/main.css';

// Dynamic year for footer
const currentYear = new Date().getFullYear();
---

<!DOCTYPE html>
<html lang="es" class="scroll-smooth">
<head>
  <!-- Basic Meta Tags -->
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content={description || defaultSEO.description} />
  <meta name="keywords" content={generateKeywords(keywords)} />
  <meta name="author" content="Metanoia Spa y Bienestar" />
  <meta name="robots" content="index, follow" />
  
  <!-- Canonical URL -->
  <link rel="canonical" href={generateCanonicalUrl()} />
  
  <!-- Open Graph Meta Tags -->
  <meta property="og:title" content={title} />
  <meta property="og:description" content={description || defaultSEO.description} />
  <meta property="og:type" content={defaultSEO.og?.type || 'website'} />
  <meta property="og:url" content={generateCanonicalUrl()} />
  <meta property="og:image" content={defaultSEO.og?.image || '/images/og-metanoia-spa.jpg'} />
  <meta property="og:image:alt" content="Metanoia Spa - Masajes y Bienestar en Providencia" />
  <meta property="og:site_name" content="Metanoia Spa y Bienestar" />
  <meta property="og:locale" content="es_CL" />
  
  <!-- Twitter Card Meta Tags -->
  <meta name="twitter:card" content={defaultSEO.twitter?.card || 'summary_large_image'} />
  <meta name="twitter:title" content={title} />
  <meta name="twitter:description" content={description || defaultSEO.description} />
  <meta name="twitter:image" content={defaultSEO.twitter?.image || '/images/og-metanoia-spa.jpg'} />
  
  <!-- Favicon and App Icons -->
  <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
  <link rel="icon" type="image/png" href="/favicon.png" />
  <link rel="apple-touch-icon" href="/apple-touch-icon.png" />
  
  <!-- Manifest -->
  <link rel="manifest" href="/site.webmanifest" />
  
  <!-- Theme Color -->
  <meta name="theme-color" content="#7d8661" />
  <meta name="msapplication-TileColor" content="#7d8661" />
  
  <!-- Preconnect to external domains for performance -->
  <link rel="preconnect" href="https://www.googletagmanager.com" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  
  <!-- DNS Prefetch for external resources -->
  <link rel="dns-prefetch" href="https://www.google.com" />
  <link rel="dns-prefetch" href="https://wa.link" />
  <link rel="dns-prefetch" href="https://instagram.com" />
  
  <!-- Title -->
  <title>{title}</title>
  
  <!-- Import global styles -->
  <style>
    /* Critical CSS for above-the-fold content */
    html {
      font-family: ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      scroll-behavior: smooth;
    }
    
    body {
      margin: 0;
      padding: 0;
      background-color: #fafaf9;
      color: #262625;
      line-height: 1.6;
    }
    
    /* Prevent flash of unstyled content */
    .loading {
      opacity: 0;
      transition: opacity 0.3s ease-in-out;
    }
    
    .loaded {
      opacity: 1;
    }
  </style>
</head>
<body class={`loading ${className}`}>
  <!-- Skip to main content link for accessibility -->
  <a href="#main-content" class="sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 focus:z-50 focus:px-4 focus:py-2 focus:bg-sage-600 focus:text-white focus:rounded-md focus:shadow-lg">
    Saltar al contenido principal
  </a>
  
  <!-- Main content -->
  <div id="main-content">
    <slot />
  </div>
  
  <!-- Footer -->
  <footer class="bg-sage-800 text-white py-12">
    <div class="section-container">
      <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
        <!-- Brand -->
        <div>
          <h3 class="text-xl font-semibold mb-4">Metanoia Spa y Bienestar</h3>
          <p class="text-cream-50/95 text-sm md:text-base leading-relaxed">
            Un espacio para la relajación, el equilibrio y el cuidado integral del cuerpo y la mente.
          </p>
        </div>
        
        <!-- Contact -->
        <div>
          <h4 class="text-lg font-medium mb-4">Contacto</h4>
          <div class="space-y-2 text-cream-50/90 text-sm md:text-base">
            <p>Av. Providencia 2601, local 14</p>
            <p>Santiago, Chile</p>
            <p>Lun–Vier 9:00–19:00</p>
            <p>Sáb 9:00–17:00</p>
          </div>
        </div>
        
        <!-- Social -->
        <div>
          <h4 class="text-lg font-medium mb-4">Síguenos</h4>
          <div class="flex space-x-4">
            <a 
              href="https://instagram.com/spa__metanoia" 
              target="_blank" 
              rel="noopener noreferrer"
              class="text-cream-50/80 hover:text-white transition-colors"
              onclick="import('../lib/analytics').then(({ trackInstagramClick }) => trackInstagramClick())"
            >
              <span class="sr-only">Instagram</span>
              <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
                <path d="M12 2.2c3.2 0 3.6 0 4.9.1 1.2.1 1.9.2 2.3.4.6.2 1 .5 1.4.9.4.4.7.8.9 1.4.2.4.3 1.1.4 2.3.1 1.3.1 1.7.1 4.9s0 3.6-.1 4.9c-.1 1.2-.2 1.9-.4 2.3-.2.6-.5 1-.9 1.4-.4.4-.8.7-1.4.9-.4.2-1.1.3-2.3.4-1.3.1-1.7.1-4.9.1s-3.6 0-4.9-.1c-1.2-.1-1.9-.2-2.3-.4-.6-.2-1-.5-1.4-.9-.4-.4-.7-.8-.9-1.4-.2-.4-.3-1.1-.4-2.3-.1-1.3-.1-1.7-.1-5s0-3.6.1-4.9c.1-1.2.2-1.9.4-2.3.2-.6.5-1 .9-1.4.4-.4.8-.7 1.4-.9.4-.2 1.1-.3 2.3-.4 1.3-.1 1.7-.1 4.9-.1zm0-2.2c-3.3 0-3.7 0-5 .1-1.3.1-2.2.2-3 .5-.8.3-1.5.7-2.2 1.4-.7.7-1.1 1.4-1.4 2.2-.3.8-.4 1.7-.5 3-.1 1.3-.1 1.7-.1 5s0 3.7.1 5c.1 1.3.2 2.2.5 3 .3.8.7 1.5 1.4 2.2.7.7 1.4 1.1 2.2 1.4.8.3 1.7.4 3 .5 1.3.1 1.7.1 5 .1s3.7 0 5-.1c1.3-.1 2.2-.2 3-.5.8-.3 1.5-.7 2.2-1.4.7-.7 1.1-1.4 1.4-2.2.3-.8.4-1.7.5-3 .1-1.3.1-1.7.1-5s0-3.7-.1-5c-.1-1.3-.2-2.2-.5-3-.3-.8-.7-1.5-1.4-2.2-.7-.7-1.4-1.1-2.2-1.4-.8-.3-1.7-.4-3-.5-1.3-.1-1.7-.1-5-.1zm0 5.8c-3.4 0-6.2 2.8-6.2 6.2s2.8 6.2 6.2 6.2 6.2-2.8 6.2-6.2-2.8-6.2-6.2-6.2zm0 10.2c-2.2 0-4-1.8-4-4s1.8-4 4-4 4 1.8 4 4-1.8 4-4 4zm7.8-10.4c0 .8-.6 1.4-1.4 1.4s-1.4-.6-1.4-1.4.6-1.4 1.4-1.4 1.4.6 1.4 1.4z"/>
              </svg>
            </a>
            <a 
              href="https://wa.link/4k3hvn" 
              target="_blank" 
              rel="noopener noreferrer"
              class="text-cream-50/80 hover:text-white transition-colors"
              onclick="import('../lib/analytics').then(({ trackWhatsAppClick }) => trackWhatsAppClick('footer'))"
            >
              <span class="sr-only">WhatsApp</span>
              <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
                <path d="M12.04 2c-5.46 0-9.91 4.45-9.91 9.91 0 1.75.46 3.45 1.32 4.95L2.05 22l5.25-1.38c1.45.79 3.08 1.21 4.74 1.21 5.46 0 9.91-4.45 9.91-9.91C21.95 6.45 17.5 2 12.04 2zm5.76 7.12c-.05-.11-.18-.18-.38-.31-.2-.14-1.17-.58-1.35-.64-.18-.07-.31-.1-.44.1-.14.2-.53.64-.65.77-.12.14-.24.16-.44.05-.2-.1-.85-.31-1.62-.99-.6-.53-1-.19-1.18-.02-.18.16-.22.26-.33.41-.1.14-.2.16-.37.05-.18-.1-.75-.28-1.43-.88-.63-.53-1.06-1.18-1.18-1.38-.12-.2-.01-.31.09-.41.09-.09.2-.24.3-.36.1-.12.14-.2.2-.34.07-.14.04-.26-.02-.36-.06-.1-.44-1.07-.6-1.46-.16-.38-.32-.33-.44-.33-.11 0-.24-.01-.37-.01-.12 0-.32.05-.49.24-.17.2-.65.63-.65 1.54s.67 1.79.76 1.91c.1.12 1.32 2.02 3.2 2.83.45.19.8.31 1.07.4.45.14.86.12 1.18.07.36-.05 1.17-.48 1.33-.94z"/>
              </svg>
            </a>
          </div>
        </div>
      </div>
      
      <div class="border-t border-sage-700 mt-8 pt-8 text-center text-cream-50/80 text-sm md:text-base">
        <p>&copy; {currentYear} Metanoia Spa y Bienestar. Todos los derechos reservados.</p>
      </div>
    </div>
  </footer>

  <!-- Load complete handler -->
  <script>
    // Remove loading class when page is fully loaded
    window.addEventListener('load', () => {
      document.body.classList.remove('loading');
      document.body.classList.add('loaded');
    });

    // Fallback in case load event doesn't fire
    setTimeout(() => {
      document.body.classList.remove('loading');
      document.body.classList.add('loaded');
    }, 1000);
  </script>
</body>
</html>
