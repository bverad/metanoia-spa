---
// TypeScript props interface
interface Props {
  className?: string;
}

// Destructure props with defaults
const { className = '' } = Astro.props;

// Map configuration
const mapConfig = {
  address: "Av. Providencia 2601, local 14, Santiago, Chile",
  businessName: "Metanoia Spa y Bienestar",
  // Coordinates for Av. Providencia 2601, Providencia, Santiago
  latitude: -33.4234,
  longitude: -70.6052,
  zoom: 16
};

// Generate Google Maps embed URL
const embedUrl = `https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3329.9!2d${mapConfig.longitude}!3d${mapConfig.latitude}!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f${mapConfig.zoom}.1!3m3!1m2!1s0x0%3A0x0!2z${encodeURIComponent(mapConfig.businessName)}!5e0!3m2!1ses!2scl!4v${Date.now()}!5m2!1ses!2scl`;
---

<div class={`relative rounded-2xl overflow-hidden shadow-lg ${className}`}>
  <!-- Interactive Google Map -->
  <iframe 
    src={embedUrl}
    class="w-full h-full border-0"
    style="min-height: 400px;"
    allowfullscreen=""
    loading="lazy"
    referrerpolicy="no-referrer-when-downgrade"
    title={`Ubicación de ${mapConfig.businessName} en ${mapConfig.address}`}
    aria-label={`Mapa interactivo mostrando la ubicación de ${mapConfig.businessName}`}
  ></iframe>
  
  <!-- Map overlay with business info -->
  <div class="absolute top-4 left-4 bg-white/95 backdrop-blur-sm rounded-xl p-4 shadow-lg max-w-xs">
    <div class="flex items-start space-x-3">
      <div class="w-10 h-10 bg-sage-600 rounded-lg flex items-center justify-center flex-shrink-0">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
        </svg>
      </div>
      <div>
        <h4 class="font-semibold text-sage-900 text-sm">
          {mapConfig.businessName}
        </h4>
        <p class="text-xs text-neutral-600 mt-1">
          {mapConfig.address}
        </p>
        <a 
          href={`https://www.google.com/maps/dir/?api=1&destination=${encodeURIComponent(mapConfig.address)}`}
          target="_blank"
          rel="noopener noreferrer"
          class="inline-flex items-center mt-2 text-xs font-medium text-sage-600 hover:text-sage-700 transition-colors"
          onclick="import('../lib/analytics').then(({ trackMapClick }) => trackMapClick())"
        >
          <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-1.447-.894L15 4m0 13V4m-6 3l6-3"></path>
          </svg>
          Cómo llegar
        </a>
      </div>
    </div>
  </div>

  <!-- Map controls hint -->
  <div class="absolute bottom-4 right-4 bg-sage-800/80 text-white text-xs px-3 py-2 rounded-lg backdrop-blur-sm">
    📍 Haz clic para interactuar
  </div>
</div>

<!-- Fallback for when maps fail to load -->
<noscript>
  <div class="bg-sage-50 rounded-2xl p-8 text-center">
    <svg class="w-16 h-16 mx-auto mb-4 text-sage-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
    </svg>
    <h3 class="text-lg font-semibold text-sage-800 mb-2">Nuestra Ubicación</h3>
    <p class="text-neutral-600 mb-4">{mapConfig.address}</p>
    <a 
      href={`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(mapConfig.address)}`}
      target="_blank"
      rel="noopener noreferrer"
      class="inline-flex items-center text-sage-600 hover:text-sage-700 font-medium"
    >
      Ver en Google Maps
      <svg class="w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path>
      </svg>
    </a>
  </div>
</noscript>
